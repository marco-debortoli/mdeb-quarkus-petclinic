schemaVersion: 2.1.0
metadata:
  generateName: quarkus-petclinic-
projects:
  - name: quarkus-petclinic
    git:
      remotes:
        origin: 'https://github.com/marco-debortoli/mdeb-quarkus-petclinic.git'
      checkoutFrom:
        revision: main

components:
  - name: postgresql
    container:
      image: registry.redhat.io/rhel8/postgresql-12@sha256:6fd58e4ede8e77b4ac434667df49150adac69273172764c54b1b0211612f51b5
      memoryLimit: 512Mi
      env:
        - name: POSTGRESQL_USER
          value: petclinic
        - name: POSTGRESQL_PASSWORD
          value: petclinic
        - name: POSTGRESQL_DATABASE
          value: petclinic
      volumeMounts:
        - name: postgres-storage
          path: /var/lib/pgsql/data
      endpoints:
        - name: postgresql
          targetPort: 5432
          attributes:
            discoverable: 'true'
            public: 'false'
  - name: postgres-storage
    volume:
      size: 1Gi

  - name: quarkus-dev
    container:
      image: registry.redhat.io/devspaces/udi-rhel8
      sourceMapping: /projects
      memoryLimit: 8Gi
      memoryRequest: 512Mi
      volumeMounts:
        - name: m2
          path: /home/user/.m2
      endpoints:
        - exposure: public
          name: quarkus-dev
          targetPort: 8080
          protocol: https
  - name: m2
    volume:
      size: 2Gi
commands:
  - id: 01build
    exec:
      component: quarkus-dev
      commandLine: 'mvn quarkus:dev'
      workingDir: '${CHE_PROJECTS_ROOT}/quarkus-petclinic'